<!DOCTYPE html>
<html>
<head>
    <title>Pok√©dex</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <button onclick="toggleDarkMode()" id="dark-mode-toggle">üåô Dark Mode</button>
    <header>
        <h1>
            <a href="/pokedex" class="reset-link">Pok√©dex</a>
        </h1>
		<a href="/pokedex?random=true" class="button-link" style="margin-left: 10px;">üé≤ Random</a>
        <div class="gen-links">
            {% for g in all_gens %}
                <a href="/generation/{{ g }}" class="button-link">Gen {{ g }}</a>
            {% endfor %}
        </div>
        <div class="type-links">
            {% for t in all_types %}
                <a href="/type/{{ t }}" class="type-label type-{{ t }}">{{ t|capitalize }}</a>
            {% endfor %}
        </div>

        <form method="get" class="form-controls form-controls--compact">
		  <div class="form-field form-field--search">
			<label for="search">Search</label>
			<input id="search" type="text" name="search" placeholder="e.g. re:pik.*" value="{{ search }}">
		  </div>

		  <div class="form-field">
			<label for="type">Type</label>
			<select id="type" name="type">
			  <option value="">All</option>
			  {% for t in all_types %}
				<option value="{{ t }}" {% if current_type == t %}selected{% endif %}>{{ t|capitalize }}</option>
			  {% endfor %}
			</select>
		  </div>

		  <!-- Sort + (reverse) together -->
		  <div class="form-field form-field--sort">
			<label for="sort">
			  Sort
			  <span class="rev-inline">
				(<input id="reverse" type="checkbox" name="reverse" value="true" {% if reverse_sort %}checked{% endif %}> reverse)
			  </span>
			</label>
			<select id="sort" name="sort">
			  <option value="id"   {% if current_sort == 'id' %}selected{% endif %}>ID</option>
			  <option value="name" {% if current_sort == 'name' %}selected{% endif %}>Name</option>
			  {% for k, label in stat_labels.items() %}
				<option value="{{ k }}" {% if current_sort == k %}selected{% endif %}>{{ label }}</option>
			  {% endfor %}
			</select>
		  </div>

		  <div class="form-field">
			<label for="generation">Generation</label>
			<select id="generation" name="generation">
			  <option value="">All</option>
			  {% for g in all_gens %}
				<option value="{{ g }}" {% if request.args.get('generation') == g|string %}selected{% endif %}>Gen {{ g }}</option>
			  {% endfor %}
			</select>
		  </div>

		  <div class="form-field form-field--perpage">
			<label for="limit">Per Page</label>
			<select id="limit" name="limit">
			  {% for n in [6,12,24,48] %}
				<option value="{{ n }}" {% if limit == n %}selected{% endif %}>{{ n }}</option>
			  {% endfor %}
			</select>
		  </div>

		  <div class="form-field form-field--button">
			<label class="visually-hidden">Apply</label>
			<button type="submit">Apply</button>
		  </div>
		</form>

    </header>

    {% if not pokemon_list %}
        <p>No Pok√©mon found.</p>
    {% endif %}

	<div class="pokemon-grid">
	  {% for p in pokemon_list %}
		<div class="pokemon-card">
		  <span class="pokemon-id">#{{ p.id }}</span>
		  <a href="/pokemon/{{ p.name | lower }}" style="text-decoration: none; color: inherit;">
			<img src="{{ p.sprite }}" alt="{{ p.name }}">
			<h3>{{ p.name }}</h3>

			<!-- show the sorted metric value if applicable -->
			{% if p.sort_display and sort_label %}
			  <div style="font-size: 0.8em; opacity: 0.85; margin-top: 2px;">
				{{ sort_label }}: {{ p.sort_display }}
			  </div>
			{% endif %}

			<div class="type-container">
			  {% for t in p.types %}
				<span class="type-label type-{{ t }}">{{ t }}</span>
			  {% endfor %}
			</div>
		  </a>
		</div>
	  {% endfor %}
	</div>

    {% if not request.args.get('random') and not request.args.get('pokemon') %}
        <div class="pagination">
            {% set prev_offset = offset - limit if offset - limit >= 0 else 0 %}
            {% set next_offset = offset + limit %}

            {% set base_args = [] %}
            {% for key, value in request.args.items() %}
                {% if key != 'offset' %}
                    {% set _ = base_args.append(key ~ '=' ~ value) %}
                {% endif %}
            {% endfor %}
            {% set base_query = '&'.join(base_args) %}

            <a href="/pokedex?{{ base_query }}&offset={{ prev_offset }}&limit={{ limit }}" class="button-link">‚Üê Prev</a>
            <a href="/pokedex?{{ base_query }}&offset={{ next_offset }}&limit={{ limit }}" class="button-link">Next ‚Üí</a>
        </div>
    {% endif %}

    <!-- === Other Resources Section === -->
    <div class="other-resources" style="text-align: center; margin-top: 2em;">
        <h3 style="margin-bottom: 0.5em;">Other Resources</h3>
        <div>
            <a href="/type_tool" class="button-link" title="Calculate type effectiveness for defense and offense">üìä Type Effectiveness Tool</a>
        </div>
    </div>

	<div class="developer-tools" style="text-align: center; margin-top: 2em;">
		<h3 style="margin-bottom: 0.5em;">Developer Tools</h3>

		<div style="margin-bottom: 1em;">
			<strong>Pok√©mon Cache:</strong><br>
			<a href="/backup_cache" class="button-link" title="Save a timestamped copy of the Pok√©mon cache">üìÅ Backup Pok√©mon Cache</a>
			<a href="#" class="button-link" onclick="confirmRefresh(event)" title="Clear and reset Pok√©mon cache">üßπ Reset Pok√©mon Cache</a>
			<a href="#" class="button-link" onclick="confirmRecover(event)" title="Recover from latest Pok√©mon backup">‚è™ Recover Pok√©mon Backup</a>
		</div>

		<div style="margin-bottom: 1em;">
			<strong>Extra Cache (Species, Types, Evolution, Generation):</strong><br>
			<a href="/backup_extra_cache" class="button-link" title="Save a timestamped copy of the extra cache">üìÅ Backup Extra Cache</a>
			<a href="#" class="button-link" onclick="confirmExtraRefresh(event)" title="Clear and reset extra cache">üßπ Reset Extra Cache</a>
			<a href="/refresh_lists" class="button-link" title="Re-fetch and refresh cached lists">‚ôªÔ∏è Refresh Pokemon/Types</a>
			<a href="#" class="button-link" onclick="confirmExtraRecover(event)" title="Recover from latest extra cache backup">‚è™ Recover Extra Backup</a>
		</div>
		
		<div>
			<a href="/toggle_logging" class="button-link" title="Toggle detailed logging on or off">
				üìù Toggle Logging
				<span style="margin-left: 0.3em; font-weight: bold; color: {{ 'limegreen' if logging_enabled else 'crimson' }}">
					{{ '‚úÖ' if logging_enabled else '‚ùå' }}
				</span>
			</a>
		</div>
	</div>

	<script>
		function toggleDarkMode() {
			const body = document.body;
			body.classList.toggle("dark-mode");
			body.classList.toggle("dark");
			localStorage.setItem("theme", body.classList.contains("dark-mode") || body.classList.contains("dark") ? "dark" : "light");
		}

		window.onload = function () {
			const savedTheme = localStorage.getItem("theme");
			if (savedTheme === "dark") {
				document.body.classList.add("dark-mode", "dark");
			}
		};

		function confirmRefresh(e) {
			if (confirm("Are you sure you want to refresh (clear) the Pok√©mon cache? This cannot be undone.")) {
				window.location.href = "/refresh_cache";
			} else {
				e.preventDefault();
			}
		}

		function confirmRecover(e) {
			if (confirm("Are you sure you want to recover the latest Pok√©mon cache backup? This will overwrite the current cache.")) {
				window.location.href = "/recover_cache";
			} else {
				e.preventDefault();
			}
		}

		function confirmExtraRefresh(e) {
			if (confirm("Are you sure you want to refresh (clear) the Extra cache? This cannot be undone.")) {
				window.location.href = "/refresh_extra_cache";
			} else {
				e.preventDefault();
			}
		}

		function confirmExtraRecover(e) {
			if (confirm("Are you sure you want to recover the latest Extra cache backup? This will overwrite the current extra cache.")) {
				window.location.href = "/recover_extra_cache";
			} else {
				e.preventDefault();
			}
		}
	</script>

</body>
</html>
